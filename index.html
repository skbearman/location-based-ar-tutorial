<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GPS AR – Debug Scene</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

  <!-- AR.js GPS + A-Frame -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/three.js/build/ar-threex-location-only.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    #gps-status {
      position: fixed;
      top: 0.5rem;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-size: 0.75rem;
      z-index: 10;
    }
  </style>
</head>

<body>

  <!-- GPS debug text -->
  <div id="gps-status">GPS: waiting…</div>

  <a-scene
    embedded
    vr-mode-ui="enabled:false"
    renderer="antialias:true; alpha:true"
    arjs="sourceType:webcam; videoTexture:true; debugUIEnabled:true">

    <!-- Always-visible NON-GPS box 2m in front of camera -->
    <a-box
      id="test-box"
      color="blue"
      position="0 0 -2"
      depth="0.5"
      height="0.5"
      width="0.5">
    </a-box>

    <!-- Preload model -->
    <a-assets>
      <a-asset-item id="magnemite" src="assets/magnemite/scene.gltf"></a-asset-item>
    </a-assets>

    <!-- GPS camera -->
    <a-camera gps-new-camera="gpsMinDistance:1"></a-camera>

    <!-- Red GPS box (will be positioned by script when GPS arrives) -->
    <a-box
      id="gps-box"
      color="red"
      depth="5"
      height="5"
      width="5">
    </a-box>

    <!-- Magnemite (also positioned by script at GPS) -->
    <a-entity
      id="magnemite-entity"
      gltf-model="#magnemite"
      scale="0.6 0.6 0.6">
    </a-entity>

  </a-scene>

<script>
  const gpsStatus = document.getElementById('gps-status');
  const cameraEl  = document.querySelector('[gps-new-camera]');
  const gpsBox    = document.getElementById('gps-box');
  const magEntity = document.getElementById('magnemite-entity');

  // When AR.js updates GPS position, anchor red box + magnemite there
  cameraEl.addEventListener('gps-camera-update-position', (e) => {
    const pos = e.detail.position;

    gpsStatus.textContent =
      `GPS: ${pos.latitude.toFixed(5)}, ${pos.longitude.toFixed(5)}`;

    // Put red box at current GPS coordinates
    gpsBox.setAttribute(
      'gps-new-entity-place',
      `latitude: ${pos.latitude}; longitude: ${pos.longitude};`
    );

    // Put Magnemite at same GPS coords
    magEntity.setAttribute(
      'gps-new-entity-place',
      `latitude: ${pos.latitude}; longitude: ${pos.longitude};`
    );
  });
</script>

</body>
</html>
