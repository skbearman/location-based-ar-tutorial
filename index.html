<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Magnemite WebXR AR</title>

    <!-- A-Frame with WebXR & ar-hit-test support -->
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>

    <style>
      body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
      #overlay {
        position: fixed;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.4rem 0.8rem;
        border-radius: 999px;
        background: rgba(0,0,0,0.5);
        color: #fff;
        font-size: 0.8rem;
        z-index: 10;
      }
    </style>
  </head>

  <body>
    <!-- A-Frame WebXR AR scene (NO AR.js here) -->
    <a-scene
      renderer="colorManagement: true; physicallyCorrectLights: true"
      vr-mode-ui="enabled: true"
      webxr="optionalFeatures: hit-test, dom-overlay; overlayElement: #overlay"
      ar-hit-test="target: #magnemite">

      <!-- Simple light so the model isn’t dark -->
      <a-entity light="type: directional; intensity: 1" position="1 2 1"></a-entity>
      <a-entity light="type: ambient; intensity: 0.5"></a-entity>

      <!-- This entity will be placed on the detected surface -->
      <a-entity
        id="magnemite"
        gltf-model="assets/magnemite/scene.gltf"
        visible="false"
        scale="0.2 0.2 0.2">
      </a-entity>

      <!-- Camera -->
      <a-entity camera look-controls></a-entity>
    </a-scene>

    <!-- UI overlay (shown on top in AR) -->
    <div id="overlay">
      Move phone to find a surface, then tap to place Magnemite.
    </div>

    <script>
      // Optional: messages when AR hit-test kicks in
      const sceneEl = document.querySelector('a-scene');
      const overlay = document.getElementById('overlay');

      sceneEl.addEventListener('enter-vr', function () {
        if (this.is('ar-mode')) {
          overlay.textContent = 'Scanning… move your phone around.';
          this.addEventListener('ar-hit-test-achieved', function () {
            overlay.textContent = 'Tap where you want Magnemite.';
          }, { once: true });

          this.addEventListener('ar-hit-test-select', function () {
            overlay.textContent = 'Magnemite placed! Walk around it.';
          }, { once: true });
        }
      });
    </script>
  </body>
</html>
