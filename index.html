<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AR.js GPS – Place Bench</title>

<!-- A-Frame -->
<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

<!-- AR.js GPS -->
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.7/three.js/build/ar-threex-location-only.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.7/aframe/build/aframe-ar.js"></script>

<style>
body{
  margin:0;
  overflow:hidden;
  font-family:system-ui, sans-serif;
}

/* PLACE BUTTON */
#ui{
  position:fixed;
  bottom:1rem;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.35);
  padding:.6rem .9rem;
  border-radius:999px;
  z-index:9999;
  backdrop-filter: blur(6px);
}

#place-btn{
  padding:.9rem 1.6rem;
  border-radius:999px;
  border:none;
  font-size:1.1rem;
  font-weight:600;
  background:#111;
  color:#fff;
}

#place-btn:disabled{
  background:#555;
  opacity:.7;
}

/* TOOLBAR */
#transform-ui{
  position:fixed;
  top:.5rem;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.45);
  padding:.5rem .75rem;
  border-radius:12px;
  display:none;
  z-index:9999;
  backdrop-filter: blur(6px);
}

#transform-ui h4{
  margin:0 0 .4rem 0;
  text-align:center;
  font-size:.9rem;
  color:white;
}

#transform-ui .row{
  display:flex;
  justify-content:center;
  gap:.35rem;
  margin-bottom:.3rem;
}

#transform-ui button{
  width:48px;
  height:48px;
  border:none;
  border-radius:8px;
  font-size:1.1rem;
  background:rgba(255,255,255,.2);
  color:white;
}

#lock-btn{
  width:auto;
  padding:.5rem 1.2rem;
  background:#ff6b6b;
  font-weight:600;
  font-size:.95rem;
}
</style>
</head>

<body>

<div id="ui">
  <button id="place-btn" disabled>Getting GPS…</button>
</div>

<div id="transform-ui">
  <h4>Adjust Bench</h4>

  <div class="row">
    <button id="move-up">↑</button>
  </div>

  <div class="row">
    <button id="move-left">←</button>
    <button id="move-down">↓</button>
    <button id="move-right">→</button>
  </div>

  <div class="row">
    <button id="height-up">Y+</button>
    <button id="height-down">Y-</button>
  </div>

  <div class="row">
    <button id="rot-left">↺</button>
    <button id="rot-right">↻</button>
  </div>

  <div class="row">
    <button id="lock-btn">Lock</button>
  </div>
</div>

<a-scene
 embedded
 vr-mode-ui="enabled:false"
 arjs="sourceType:webcam; debugUIEnabled:true"
 renderer="antialias:true; alpha:true">

  <!-- GPS camera -->
  <a-camera gps-new-camera="gpsMinDistance:3; positionMinAccuracy:50"></a-camera>

</a-scene>

<script>
const THREE = AFRAME.THREE;

const scene     = document.querySelector('a-scene');
const camera    = document.querySelector('[gps-new-camera]');
const placeBtn  = document.getElementById('place-btn');
const toolbar   = document.getElementById('transform-ui');
const lockBtn   = document.getElementById('lock-btn');

let lastCoords = null;
let activeBench = null;

/* GPS READY */
camera.addEventListener('gps-camera-update-position', e=>{
  lastCoords = {
    latitude:  e.detail.position.latitude,
    longitude: e.detail.position.longitude
  };

  placeBtn.disabled = false;
  placeBtn.textContent = "Place Bench Here";
});

/* PLACE BENCH */
placeBtn.onclick = ()=>{
  if(!lastCoords) return;

  const bench = document.createElement('a-entity');

  bench.setAttribute('gltf-model','assets/park_bench.glb');
  bench.setAttribute(
    'gps-new-entity-place',
    `latitude:${lastCoords.latitude}; longitude:${lastCoords.longitude}`
  );

  bench.setAttribute('scale','1 1 1');
  bench.setAttribute('position','0 0 0');

  const forward = new THREE.Vector3();
  camera.object3D.getWorldDirection(forward);
  const yaw = Math.atan2(forward.x,forward.z) * 180/Math.PI;
  bench.setAttribute('rotation',`0 ${yaw} 0`);

  scene.appendChild(bench);

  activeBench = bench;
  toolbar.style.display = "block";
};

/* HELPERS */
function pos(){ return activeBench.getAttribute('position'); }
function rot(){ return activeBench.getAttribute('rotation'); }

function setPos(p){ activeBench.setAttribute('position', p); }
function setRot(r){ activeBench.setAttribute('rotation', r); }

const MOVE_STEP   = 2;
const HEIGHT_STEP = 1;
const ROT_STEP    = 15;

/* MOVE RELATIVE TO CAMERA */
function move(fwd, side){
  if(!activeBench) return;

  const p = {...pos()};
  const fwdVec = new THREE.Vector3();
  camera.object3D.getWorldDirection(fwdVec);
  fwdVec.y = 0;
  fwdVec.normalize();

  const right = new THREE.Vector3(fwdVec.z,0,-fwdVec.x);

  p.x += (fwdVec.x*fwd + right.x*side) * MOVE_STEP;
  p.z += (fwdVec.z*fwd + right.z*side) * MOVE_STEP;

  setPos(p);
}

/* BUTTON EVENTS */
moveUp.onclick    = ()=>move(1,0);
moveDown.onclick  = ()=>move(-1,0);
moveLeft.onclick  = ()=>move(0,-1);
moveRight.onclick = ()=>move(0,1);

heightUp.onclick = ()=>{
  if(!activeBench) return;
  const p={...pos()};
  p.y+=HEIGHT_STEP;
  setPos(p);
};

heightDown.onclick = ()=>{
  if(!activeBench) return;
  const p={...pos()};
  p.y-=HEIGHT_STEP;
  setPos(p);
};

rotLeft.onclick = ()=>{
  if(!activeBench) return;
  const r={...rot()};
  r.y-=ROT_STEP;
  setRot(r);
};

rotRight.onclick = ()=>{
  if(!activeBench) return;
  const r={...rot()};
  r.y+=ROT_STEP;
  setRot(r);
};

lockBtn.onclick = ()=>{
  activeBench = null;
  toolbar.style.display = "none";
};
</script>

</body>
</html>
