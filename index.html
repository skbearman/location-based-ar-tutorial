<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tap-to-Place Magnemite</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

  <!-- AR.js (camera-based AR) -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }

    #ui {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      z-index: 10;
      font-family: system-ui, sans-serif;
    }

    .btn {
      padding: 0.5rem 1rem;
      border-radius: 999px;
      border: none;
      font-size: 0.85rem;
      font-weight: 600;
      background: #222;
      color: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      opacity: 0.9;
    }
  </style>
</head>

<body>

<div id="ui">
  <button id="rot-left"  class="btn">⟲ Rotate</button>
  <button id="rot-right" class="btn">⟳ Rotate</button>
  <button id="move-up"    class="btn">⬆ Up</button>
  <button id="move-down"  class="btn">⬇ Down</button>
  <button id="move-left"  class="btn">⬅ Left</button>
  <button id="move-right" class="btn">➡ Right</button>
</div>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  renderer="antialias: true; alpha: true"
  arjs="sourceType: webcam; debugUIEnabled: true">

  <!-- Preload model -->
  <a-assets>
    <a-asset-item id="magnemite" src="assets/magnemite/scene.gltf"></a-asset-item>
  </a-assets>

  <!-- Camera / Raycaster -->
  <a-camera
    id="camera"
    position="0 1.6 0"
    cursor="rayOrigin: mouse"
    raycaster="objects: .click-target">
  </a-camera>

  <!-- Invisible tap plane -->
  <a-entity id="ground"
    class="click-target"
    geometry="primitive: plane; width: 20; height: 20"
    material="transparent:true; opacity:0"
    position="0 0 -4"
    rotation="-90 0 0">
  </a-entity>

</a-scene>

<script>
const THREE = AFRAME.THREE;

let selectedEntity = null;

const sceneEl  = document.querySelector('a-scene');
const ground   = document.getElementById('ground');
const cameraEl = document.getElementById('camera');

/* -------------------------------------
   TAP TO SPAWN
------------------------------------- */

ground.addEventListener('click', (evt) => {
  const hit = evt.detail.intersection;
  if (!hit) return;

  const point = hit.point;

  const entity = document.createElement('a-entity');
  entity.setAttribute('gltf-model', '#magnemite');
  entity.setAttribute('scale', '1 1 1');
  entity.setAttribute('position', `${point.x} ${point.y} ${point.z}`);

  // Face camera at spawn time
  const camPos = new THREE.Vector3();
  cameraEl.object3D.getWorldPosition(camPos);

  const dx = camPos.x - point.x;
  const dz = camPos.z - point.z;

  const yaw = Math.atan2(dx, dz) * 180 / Math.PI;

  entity.setAttribute('rotation', `0 ${yaw} 0`);

  sceneEl.appendChild(entity);
  selectedEntity = entity;
});

/* -------------------------------------
   ROTATION
------------------------------------- */

function rotateSelected(delta) {
  if (!selectedEntity) return;
  const r = selectedEntity.getAttribute('rotation');
  selectedEntity.setAttribute('rotation',
    `0 ${r.y + delta} 0`
  );
}

/* -------------------------------------
   TRANSLATION
------------------------------------- */

function moveVertical(dy) {
  if (!selectedEntity) return;
  const p = selectedEntity.getAttribute('position');
  selectedEntity.setAttribute('position',
    `${p.x} ${p.y + dy} ${p.z}`
  );
}

function moveSideways(dir) {
  if (!selectedEntity) return;

  // Camera right vector
  const right = new THREE.Vector3(1,0,0);
  cameraEl.object3D.getWorldDirection(right);
  right.cross(new THREE.Vector3(0,1,0)).normalize();

  if (dir === 'LEFT') right.multiplyScalar(-1);

  right.multiplyScalar(0.25); // step size

  const p = selectedEntity.getAttribute('position');

  selectedEntity.setAttribute(
    'position',
    `${p.x + right.x} ${p.y + right.y} ${p.z + right.z}`
  );
}

/* -------------------------------------
   BUTTONS
------------------------------------- */

document.getElementById('rot-left').onclick  = () => rotateSelected(-15);
document.getElementById('rot-right').onclick = () => rotateSelected(15);

document.getElementById('move-up').onclick    = () => moveVertical(0.2);
document.getElementById('move-down').onclick  = () => moveVertical(-0.2);

document.getElementById('move-left').onclick  = () => moveSideways('LEFT');
document.getElementById('move-right').onclick = () => moveSideways('RIGHT');
</script>

</body>
</html>
